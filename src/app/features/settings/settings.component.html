<div class="page-container">
  <h1>Einstellungen / Status</h1>

  <!-- Connection Status Card -->
  <p-card header="Verbindungsstatus" styleClass="mb-4">
    <div class="status-grid">
      <div class="status-row">
        <span class="status-label">Backend-Typ:</span>
        <p-tag [value]="backendTypeDisplay" [severity]="isConnected ? 'success' : 'secondary'"></p-tag>
      </div>
      <div class="status-row">
        <span class="status-label">Verbindungsstatus:</span>
        <p-tag [value]="isConnected ? 'Verbunden' : 'Nicht verbunden'" [severity]="isConnected ? 'success' : 'danger'"></p-tag>
      </div>
      <div class="status-row" *ngIf="dataDirectoryName">
        <span class="status-label">Datenverzeichnis:</span>
        <span class="status-value">{{ dataDirectoryName }}</span>
      </div>
      <div class="status-row" *ngIf="datastoreInfo">
        <span class="status-label">Datenstand:</span>
        <span class="status-value">{{ datastoreInfo }}</span>
      </div>
      <div class="status-row" *ngIf="topicsCount !== null">
        <span class="status-label">Themen:</span>
        <span class="status-value">{{ topicsCount }}</span>
      </div>
      <div class="status-row" *ngIf="membersCount !== null">
        <span class="status-label">Teammitglieder:</span>
        <span class="status-value">{{ membersCount }}</span>
      </div>
    </div>
  </p-card>

  <!-- Data Directory Card -->
  <p-card header="Datenverzeichnis" styleClass="mb-4">
    <p class="mb-3">
      Wählen Sie ein Verzeichnis für die Datenspeicherung. 
      Das Verzeichnis sollte für alle Benutzer zugänglich sein (z.B. SMB-Freigabe).
    </p>
    
    <div class="action-row mb-3">
      <p-button 
        label="Verzeichnis auswählen" 
        icon="pi pi-folder-open" 
        (onClick)="selectDataDirectory()"
        [loading]="isConnecting"
        severity="primary">
      </p-button>
      <span class="current-dir" *ngIf="dataDirectoryName">
        <i class="pi pi-check-circle check-icon"></i>
        {{ dataDirectoryName }}
      </span>
    </div>

    <p-message *ngIf="!isConnected" severity="info">
      Bitte wählen Sie ein Datenverzeichnis aus, um die Anwendung zu verwenden.
    </p-message>

    <p-divider></p-divider>

    <h4>Verzeichnis initialisieren</h4>
    <p class="mb-3">
      Wenn das ausgewählte Verzeichnis leer ist, können Sie es mit den erforderlichen Dateien initialisieren.
    </p>
    
    <p-button 
      label="Verzeichnis initialisieren (Bootstrap)" 
      icon="pi pi-refresh" 
      (onClick)="bootstrapDataDirectory()"
      [disabled]="!isConnected || !canBootstrap"
      [loading]="isBootstrapping"
      severity="secondary">
    </p-button>
    
    <p-message *ngIf="isConnected && !canBootstrap" severity="warn" styleClass="mt-3">
      Das Verzeichnis enthält bereits Daten. Ein Bootstrap würde diese überschreiben.
    </p-message>
    <p-message *ngIf="bootstrapMessage" [severity]="bootstrapMessageSeverity" styleClass="mt-3">
      {{ bootstrapMessage }}
    </p-message>
  </p-card>

  <!-- Backend Type Selection Card -->
  <p-card header="Backend-Konfiguration" styleClass="mb-4">
    <p class="mb-3">
      Wählen Sie den Backend-Typ für die Datenspeicherung. 
      <strong>Hinweis:</strong> Um den Backend-Typ dauerhaft zu ändern, 
      muss die Anwendung neu konfiguriert werden (siehe BACKEND_MIGRATION.md).
    </p>
    
    <div class="backend-selector mb-3">
      <p-selectButton 
        [options]="backendOptions" 
        [(ngModel)]="selectedBackendType"
        [disabled]="true"
        optionLabel="label" 
        optionValue="value">
      </p-selectButton>
    </div>

    <p-message severity="info">
      Der Backend-Typ ist derzeit auf <strong>{{ backendTypeDisplay }}</strong> festgelegt. 
      Um zum REST-Backend zu wechseln, folgen Sie der Anleitung in BACKEND_MIGRATION.md.
    </p-message>

    <p-divider></p-divider>

    <h4>REST API Konfiguration (Platzhalter)</h4>
    <p class="mb-3 text-muted">
      Diese Funktion wird in einer zukünftigen Version verfügbar sein.
      Wenn aktiviert, können Sie hier die URL des REST-Backends konfigurieren.
    </p>
    <div class="rest-config-placeholder">
      <label>API Base URL:</label>
      <input type="text" class="rest-url-input" value="/api" disabled placeholder="https://api.example.com/api" />
      <p-button 
        label="Verbindung testen" 
        icon="pi pi-check" 
        severity="secondary"
        [disabled]="true"
        size="small">
      </p-button>
    </div>
  </p-card>

  <!-- Diagnostics Card -->
  <p-card header="Diagnose" styleClass="mb-4">
    <div class="status-grid">
      <div class="status-row">
        <span class="status-label">Browser:</span>
        <span class="status-value">{{ browserInfo }}</span>
      </div>
      <div class="status-row">
        <span class="status-label">File System Access API:</span>
        <p-tag [value]="hasFileSystemAPI ? 'Unterstützt' : 'Nicht unterstützt'" [severity]="hasFileSystemAPI ? 'success' : 'danger'"></p-tag>
      </div>
      <div class="status-row">
        <span class="status-label">App Version:</span>
        <span class="status-value">0.0.0</span>
      </div>
    </div>
  </p-card>
</div>
