<div class="search-page">
  <!-- Quick Connect Panel - shown when not connected -->
  <div class="quick-connect-panel" *ngIf="!isConnected">
    <p-card styleClass="connect-card">
      <div class="connect-content">
        <i class="pi pi-folder-open connect-icon"></i>
        <h2>Willkommen beim RACI Topic Finder</h2>
        <p>Um zu beginnen, verbinden Sie die Anwendung mit einem Datenverzeichnis.</p>
        <p class="connect-hint">
          Wählen Sie ein Verzeichnis auf einem gemeinsamen Netzlaufwerk (z.B. SMB-Freigabe),
          damit alle Teammitglieder auf die gleichen Daten zugreifen können.
        </p>
        <p-button 
          label="Schnellverbindung - Datenverzeichnis wählen" 
          icon="pi pi-folder-open" 
          (onClick)="quickConnect()"
          [loading]="isConnecting"
          severity="primary"
          size="large">
        </p-button>
        <p-message *ngIf="!hasFileSystemAPI" severity="error" styleClass="mt-3">
          Ihr Browser unterstützt die File System Access API nicht. 
          Bitte verwenden Sie Chrome, Edge oder einen anderen Chromium-basierten Browser.
        </p-message>
        <p-message *ngIf="connectError" severity="error" styleClass="mt-3">
          {{ connectError }}
        </p-message>
      </div>
    </p-card>
  </div>

  <!-- Main search UI - shown when connected -->
  <div *ngIf="isConnected">
    <div class="search-header">
      <h1>Schnellsuche</h1>
      <p>Finden Sie schnell Themen, Personen oder Tags</p>
    </div>

    <div class="search-box">
      <span class="p-input-icon-left" style="width: 100%">
        <i class="pi pi-search"></i>
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Thema, Person oder Tag suchen..."
          style="width: 100%"
          #searchInput
          autofocus />
      </span>
    </div>

    <div class="search-results" *ngIf="searchResults.length > 0">
      <p class="results-count">{{ searchResults.length }} Ergebnis(se) gefunden</p>
      
      <div class="result-list">
        <!-- Topic Result -->
        <ng-container *ngFor="let result of searchResults; let i = index">
          <p-card *ngIf="result.topic"
                  [ngClass]="{'selected': i === selectedIndex}"
                  (click)="selectResult(i)">
            <ng-template pTemplate="header">
              <div class="result-header">
                <div class="result-title-row">
                  <p-tag [value]="getKindLabel(result.hit.kind)" 
                         [severity]="getKindSeverity(result.hit.kind)"
                         styleClass="kind-tag">
                  </p-tag>
                  <h3>{{ result.topic.header }}</h3>
                </div>
                <p-tag [value]="getValidityBadge(result.topic)" 
                       [severity]="getValiditySeverity(result.topic)">
                </p-tag>
              </div>
            </ng-template>
            
            <div class="result-body">
              <div class="raci-info" *ngIf="result.topic.raci">
                <div class="raci-item">
                  <strong>R1:</strong> {{ getMemberName(result.topic.raci.r1MemberId) }}
                </div>
                <div class="raci-item" *ngIf="result.topic.raci.r2MemberId">
                  <strong>R2:</strong> {{ getMemberName(result.topic.raci.r2MemberId) }}
                </div>
                <div class="raci-item" *ngIf="result.topic.raci.r3MemberId">
                  <strong>R3:</strong> {{ getMemberName(result.topic.raci.r3MemberId) }}
                </div>
              </div>

              <p *ngIf="result.topic.description" class="description">
                {{ result.topic.description }}
              </p>

              <div class="tags" *ngIf="result.topic.tags && result.topic.tags.length > 0">
                <p-tag *ngFor="let tag of result.topic.tags" 
                       [value]="tag" 
                       severity="info">
                </p-tag>
              </div>
            </div>

            <ng-template pTemplate="footer">
              <div class="result-actions">
                <p-button label="Kopieren" icon="pi pi-copy" severity="secondary" size="small" (onClick)="copyToClipboard(result)"></p-button>
              </div>
            </ng-template>
          </p-card>

          <!-- Member Result -->
          <p-card *ngIf="result.member"
                  [ngClass]="{'selected': i === selectedIndex}"
                  (click)="selectResult(i)">
            <ng-template pTemplate="header">
              <div class="result-header">
                <div class="result-title-row">
                  <p-tag [value]="getKindLabel(result.hit.kind)" 
                         [severity]="getKindSeverity(result.hit.kind)"
                         styleClass="kind-tag">
                  </p-tag>
                  <h3>{{ result.member.displayName }}</h3>
                </div>
                <p-tag [value]="result.member.active ? 'Aktiv' : 'Inaktiv'" 
                       [severity]="result.member.active ? 'success' : 'secondary'">
                </p-tag>
              </div>
            </ng-template>
            
            <div class="result-body">
              <p *ngIf="result.member.email" class="email">
                <i class="pi pi-envelope"></i> {{ result.member.email }}
              </p>
              <div class="tags" *ngIf="result.member.tags && result.member.tags.length > 0">
                <p-tag *ngFor="let tag of result.member.tags" 
                       [value]="tag" 
                       severity="info">
                </p-tag>
              </div>
            </div>

            <ng-template pTemplate="footer">
              <div class="result-actions">
                <p-button label="Kopieren" icon="pi pi-copy" severity="secondary" size="small" (onClick)="copyToClipboard(result)"></p-button>
              </div>
            </ng-template>
          </p-card>

          <!-- Tag Result -->
          <p-card *ngIf="result.tag"
                  [ngClass]="{'selected': i === selectedIndex}"
                  (click)="selectResult(i)">
            <ng-template pTemplate="header">
              <div class="result-header">
                <div class="result-title-row">
                  <p-tag [value]="getKindLabel(result.hit.kind)" 
                         [severity]="getKindSeverity(result.hit.kind)"
                         styleClass="kind-tag">
                  </p-tag>
                  <h3>{{ result.tag.name }}</h3>
                </div>
              </div>
            </ng-template>
            
            <div class="result-body">
              <p *ngIf="result.tag.hinweise" class="hinweise">
                <strong>Hinweise:</strong> {{ result.tag.hinweise }}
              </p>
              <p *ngIf="result.tag.copyPasteText" class="copy-paste-text">
                {{ result.tag.copyPasteText }}
              </p>
            </div>

            <ng-template pTemplate="footer">
              <div class="result-actions">
                <p-button label="Kopieren" icon="pi pi-copy" severity="secondary" size="small" (onClick)="copyToClipboard(result)"></p-button>
              </div>
            </ng-template>
          </p-card>
        </ng-container>
      </div>
    </div>

    <div class="no-results" *ngIf="searchQuery && searchResults.length === 0">
      <i class="pi pi-search"></i>
      <p>Keine Ergebnisse gefunden</p>
    </div>

    <div class="empty-state" *ngIf="!searchQuery">
      <i class="pi pi-search"></i>
      <p>Geben Sie einen Suchbegriff ein, um Themen, Personen oder Tags zu finden</p>
    </div>
  </div>
</div>
